<!DOCTYPE html>
<html>
<head>
    <title>Detailed BBO Format Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 1000px; margin: 0 auto; }
        .section { margin: 30px 0; padding: 20px; background: #f9f9f9; border-radius: 6px; border-left: 4px solid #667eea; }
        .section h2 { margin-top: 0; }
        pre { background: #f0f0f0; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .hand { margin: 10px 0; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 4px; }
        .correct { background: #c8e6c9; border-color: #4caf50; }
        .iframe-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .test-box { border: 2px solid #ddd; border-radius: 6px; overflow: hidden; }
        .test-box h3 { margin: 0; padding: 10px; background: #667eea; color: white; }
        .test-box iframe { width: 100%; height: 350px; display: block; }
        .test-box .info { padding: 10px; background: #f9f9f9; font-size: 11px; max-height: 100px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>BBO Format Debug - Exact Hand Data</h1>
        
        <div class="section">
            <h2>Database Hand Data (Raw)</h2>
            <div id="databaseHands"></div>
        </div>
        
        <div class="section">
            <h2>Formatted for LIN</h2>
            <pre id="formattedHands"></pre>
        </div>
        
        <div class="section">
            <h2>Test with different formats</h2>
            <div class="iframe-container">
                <div class="test-box">
                    <h3>Using: md|n[N],[S],[E],[W]</h3>
                    <iframe id="iframe1"></iframe>
                    <div class="info" id="info1"></div>
                </div>
                <div class="test-box">
                    <h3>Using: md|n[W],[E],[S],[N]</h3>
                    <iframe id="iframe2"></iframe>
                    <div class="info" id="info2"></div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>What we expect to see in BBO</h2>
            <pre>North position: Q864 J97 T3 A842
South position: 7 A53 K97 J97653
East position: AKJT93 Q QJ854 T
West position: 52 KT8642 A62 KQ</pre>
        </div>
    </div>

    <script>
        async function debug() {
            try {
                const response = await fetch('hands_database.json?v=' + Date.now());
                const db = await response.json();
                const board = db.events['hosgoru_04_01_2026'].boards['1'];
                const hands = board.hands;
                
                // Display raw database hands
                let html = '';
                const positions = ['North', 'South', 'East', 'West'];
                positions.forEach(pos => {
                    const hand = hands[pos];
                    const isCorrect = (
                        (pos === 'North' && hand.S === 'Q864') ||
                        (pos === 'South' && hand.S === '7') ||
                        (pos === 'East' && hand.S === 'AKJT93') ||
                        (pos === 'West' && hand.S === '52')
                    );
                    html += `<div class="hand ${isCorrect ? 'correct' : ''}">
                        <strong>${pos}</strong>: 
                        S:${hand.S} H:${hand.H} D:${hand.D} C:${hand.C}
                    </div>`;
                });
                document.getElementById('databaseHands').innerHTML = html;
                
                // Format hands
                const formatHand = (playerHand) => {
                    if (!playerHand) return 'SDHC';
                    const suits = ['S', 'H', 'D', 'C'];
                    return suits.map(s => s + (playerHand[s] || '-')).join('');
                };
                
                const N = formatHand(hands.North);
                const S = formatHand(hands.South);
                const E = formatHand(hands.East);
                const W = formatHand(hands.West);
                
                let formatted = `North: ${N}\n`;
                formatted += `South: ${S}\n`;
                formatted += `East:  ${E}\n`;
                formatted += `West:  ${W}`;
                
                document.getElementById('formattedHands').textContent = formatted;
                
                // Test 1: Standard order
                const lin1 = `md|n${N},${S},${E},${W}|sv|n`;
                const url1 = `https://www.bridgebase.com/tools/handviewer.html?lin=${encodeURIComponent(lin1)}`;
                document.getElementById('iframe1').src = url1;
                document.getElementById('info1').innerHTML = `<strong>LIN:</strong><br>${lin1.substring(0, 80)}...`;
                
                // Test 2: West-East swapped
                const lin2 = `md|n${W},${E},${S},${N}|sv|n`;
                const url2 = `https://www.bridgebase.com/tools/handviewer.html?lin=${encodeURIComponent(lin2)}`;
                document.getElementById('iframe2').src = url2;
                document.getElementById('info2').innerHTML = `<strong>LIN:</strong><br>${lin2.substring(0, 80)}...`;
                
                console.log('Test 1 LIN:', lin1);
                console.log('Test 2 LIN:', lin2);
                
            } catch (error) {
                console.error('Error:', error);
                document.body.innerHTML += '<p style="color:red;">Error: ' + error.message + '</p>';
            }
        }
        
        debug();
    </script>
</body>
</html>
