<!DOCTYPE html>
<html>
<head>
    <title>BridgeBase URL Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .container { max-width: 1000px; margin: 0 auto; }
        pre { background: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd; overflow-x: auto; word-break: break-all; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; margin-top: 20px; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>BridgeBase URL Test</h1>
        
        <h2>1. Load Data and Build URL</h2>
        <pre id="debug"></pre>
        
        <h2>2. Generated URL</h2>
        <pre id="url"></pre>
        
        <h2>3. BridgeBase Viewer</h2>
        <div id="iframeContainer"></div>
    </div>
    
    <script>
        async function test() {
            const debug = document.getElementById('debug');
            const urlEl = document.getElementById('url');
            
            try {
                // Load data
                const data = await fetch('hands_database.json').then(r => r.json());
                const event = Object.values(data.events)[0];
                const board = Object.values(event.boards)[0];
                
                debug.textContent += `Event: ${event.name}\n`;
                debug.textContent += `Board dealer: ${board.dealer}\n`;
                debug.textContent += `Board vulnerability: ${board.vulnerability}\n`;
                debug.textContent += `Contract: ${board.result.contract}\n\n`;
                
                debug.textContent += 'Hands:\n';
                ['North', 'South', 'East', 'West'].forEach(pos => {
                    const hand = board.hands[pos];
                    debug.textContent += `${pos}: S=${hand.S} H=${hand.H} D=${hand.D} C=${hand.C}\n`;
                });
                
                // Build URL
                function getHandStr(hand) {
                    if (!hand) return '';
                    return (hand.S || '') + (hand.H || '') + (hand.D || '') + (hand.C || '');
                }
                
                const vulnMap = { 'None': 'n', 'NS': 'b', 'EW': 'e', 'Both': 'b' };
                const nStr = getHandStr(board.hands.North);
                const sStr = getHandStr(board.hands.South);
                const eStr = getHandStr(board.hands.East);
                const wStr = getHandStr(board.hands.West);
                
                debug.textContent += `\nHand Strings:\n`;
                debug.textContent += `N: ${nStr}\n`;
                debug.textContent += `S: ${sStr}\n`;
                debug.textContent += `E: ${eStr}\n`;
                debug.textContent += `W: ${wStr}\n`;
                
                const url = `https://www.bridgebase.com/tools/handviewer.html?n=${nStr}&s=${sStr}&e=${eStr}&w=${wStr}&d=${board.dealer}&v=${vulnMap[board.vulnerability] || 'n'}&c=${board.result.contract}`;
                
                urlEl.textContent = url;
                
                // Load iframe
                document.getElementById('iframeContainer').innerHTML = `<iframe src="${url}"></iframe>`;
                
            } catch (error) {
                debug.textContent += `ERROR: ${error.message}\n`;
            }
        }
        
        test();
    </script>
</body>
</html>
