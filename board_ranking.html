<html>
<head>
<meta charset="UTF-8">
<title>Board Rankings</title>
<style>
body { background: #1e3c72; color: #fff; font-family: Arial; padding: 20px; }
h1 { color: #00d9ff; text-align: center; }
.controls { background: #2a2a4a; padding: 15px; border-radius: 8px; margin: 20px 0; }
input, button { padding: 8px; margin: 5px; background: #3a3a5a; color: #fff; border: 1px solid #444; border-radius: 4px; }
button { background: #00d9ff; color: #000; cursor: pointer; }
table { width: 100%; background: #fff; color: #000; border-collapse: collapse; margin: 20px 0; }
th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
thead { background: #1e3c72; color: #fff; }
.ns { background: #4a90e2; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 0.85em; }
.ew { background: #f5a623; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 0.85em; }
</style>
</head>
<body>
<div style="max-width:1000px; margin:0 auto;">
<h1>Board Rankings</h1>
<div class="controls">
<div><label>Date: <input type="date" id="dateInput"></label></div>
<div><label>Board: <input type="number" id="boardInput" min="1" max="30" value="1"></label> <button onclick="loadBoard()">Load</button></div>
</div>
<div id="content" style="background:rgba(255,255,255,0.05); padding:20px; border-radius:8px; min-height:300px;">Loading...</div>
</div>
<script>
let boardData = {}, eventData = {};
async function init(){
  try {
    console.log('Init starting...');
    let response = await fetch('/board_results.json');
    console.log('Fetch response status:', response.status);
    let data = await response.json();
    boardData = data.boards || {};
    eventData = data.events || {};
    console.log('Data loaded - Events:', Object.keys(eventData).length, 'Boards:', Object.keys(boardData).length);
    
    if(eventData && Object.keys(eventData).length > 0){
      let firstEvent = Object.values(eventData)[0];
      let dateStr = firstEvent.date;
      console.log('First event date:', dateStr);
      
      if(dateStr && dateStr.includes('.')){
        let parts = dateStr.split('.');
        let convertedDate = parts[2]+'-'+parts[1]+'-'+parts[0];
        document.getElementById('dateInput').value = convertedDate;
        console.log('Set date to:', convertedDate);
      }
      loadBoard();
    } else {
      console.error('No events found in data');
      document.getElementById('content').innerHTML = 'Error: No events data';
    }
  } catch(e) {
    console.error('Error:', e);
    document.getElementById('content').innerHTML = 'Error: ' + e.message;
  }
}
function loadBoard(){
  let selectedDate = document.getElementById('dateInput').value;
  let boardNum = document.getElementById('boardInput').value;
  console.log('Loading board:', boardNum, 'for date:', selectedDate);
  
  let eventId = null;
  for(let [id, ev] of Object.entries(eventData)){
    let evDate = ev.date;
    if(evDate && evDate.includes('.')){
      let parts = evDate.split('.');
      evDate = parts[2]+'-'+parts[1]+'-'+parts[0];
    }
    if(evDate === selectedDate){
      eventId = id;
      break;
    }
  }
  
  if(!eventId){
    document.getElementById('content').innerHTML = '<p>No event found for date: ' + selectedDate + '</p><p>Available dates: ' + Object.values(eventData).map(e => e.date).join(', ') + '</p>';
    return;
  }
  
  console.log('Found eventId:', eventId);
  
  let boardKey = eventId + '_' + boardNum;
  console.log('Looking for boardKey:', boardKey);
  console.log('Available keys sample:', Object.keys(boardData).slice(0, 5));
  
  let boardInfo = boardData[boardKey];
  if(!boardInfo || !boardInfo.results){
    document.getElementById('content').innerHTML = '<p>Board not found for: ' + boardKey + '</p><p>Sample boards for event: ' + Object.keys(boardData).filter(k => k.startsWith(eventId)).slice(0, 5).join(', ') + '</p>';
    return;
  }
  
  console.log('Found board with', boardInfo.results.length, 'results');
  
  let html = '<table><thead><tr><th>Rank</th><th>Pair</th><th>Dir</th><th>Contract</th><th>Lead</th><th>Result</th><th>Score</th><th>%</th></tr></thead><tbody>';
  for(let r of boardInfo.results){
    let dirClass = r.direction === 'NS' ? 'ns' : 'ew';
    let score = r.score > 0 ? '+'+r.score : r.score;
    html += '<tr><td>'+r.rank+'</td><td>'+r.pair_names+'</td><td><span class="'+dirClass+'">'+r.direction+'</span></td><td>'+r.contract+'</td><td>'+r.lead+'</td><td>'+r.result+'</td><td>'+score+'</td><td>'+(r.percent ? r.percent.toFixed(1) : '0')+'%</td></tr>';
  }
  html += '</tbody></table>';
  document.getElementById('content').innerHTML = html;
}
window.onload = init;
</script>
</body>
</html>
