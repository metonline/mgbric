<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Ho≈üg√∂r√º Bri√ß Kul√ºb√º - Ellerin Kƒ±lavuz G√∂r√ºn√ºm√º">
    <title>Ellerin Kƒ±lavuz G√∂r√ºn√ºm√º</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .tournament-info {
            text-align: center;
            color: #aaa;
            margin-bottom: 25px;
            font-size: 0.95em;
        }
        
        /* Filter Section */
        .filter-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #00d9ff;
            font-size: 0.95em;
        }
        
        .filter-group select {
            padding: 8px 12px;
            background: #2a3f5f;
            color: #fff;
            border: 2px solid #00d9ff;
            border-radius: 4px;
            font-size: 0.95em;
            cursor: pointer;
            min-width: 150px;
        }
        
        .filter-group select:hover {
            background: #3a4f6f;
        }
        
        .filter-group select:focus {
            outline: none;
            border-color: #00ffff;
        }
        
        .clear-filter {
            padding: 8px 16px;
            background: #ff6b6b;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .clear-filter:hover {
            background: #ff5252;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #00d9ff;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: #ff6b6b;
            background: rgba(255,107,107,0.1);
            border-radius: 8px;
        }
        
        /* GRID LAYOUT */
        .hands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(520px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .hands-grid {
                grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .hands-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== BBO STYLE HAND DIAGRAM ===== */
        .hand-diagram-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .mainDivStyle {
            position: relative;
            width: 500px;
            height: 475px;
            background: #c0c1c0;
            border-radius: 4px;
            overflow: visible;
        }
        
        .handDivStyle {
            position: absolute;
            background: #cbcbcb;
            width: 160px;
            height: 124px;
            font-size: 22px;
        }
        
        .suitRowDivStyle {
            position: relative;
            height: 25px;
            line-height: 25px;
            white-space: nowrap;
            padding-left: 5px;
        }
        
        .suitSymbol {
            display: inline-block;
            width: 30px;
            font-size: 30px;
            text-align: center;
            vertical-align: middle;
        }
        
        .suitHolding {
            display: inline-block;
            font-size: 22px;
            letter-spacing: 2px;
            vertical-align: middle;
            color: #000;
        }
        
        .nameRowDivStyle {
            position: absolute;
            height: 30px;
            line-height: 30px;
            border: 1px solid white;
            white-space: nowrap;
            font-size: 18px;
            font-weight: bold;
            background: white;
        }
        
        .nameInitial {
            display: inline-block;
            width: 30px;
            text-align: center;
            font-weight: bold;
            color: #000;
            font-size: 16px;
        }
        
        .vulInnerDivStyle {
            position: absolute;
            background: white;
            border: 3px solid #880000;
            font-size: 42px;
            font-weight: bold;
            text-align: center;
            width: 60px;
            height: 60px;
            line-height: 54px;
        }
        
        .dealer-bg { background: #ffce00 !important; color: black !important; }
        .vul-bg { background: #cb0000 !important; color: white !important; }
        
        /* Position Classes */
        .pos-n-name { left: 170px; top: 5px; width: 160px; }
        .pos-n-hand { left: 170px; top: 35px; }
        .pos-w-name { left: 5px; top: 160px; width: 160px; }
        .pos-w-hand { left: 5px; top: 190px; }
        .pos-e-name { left: 335px; top: 160px; width: 160px; }
        .pos-e-hand { left: 335px; top: 190px; }
        .pos-s-name { left: 170px; top: 315px; width: 160px; }
        .pos-s-hand { left: 170px; top: 345px; }
        .pos-board { 
            left: 220px; 
            top: 215px;
            width: 60px;
            height: 60px;
            background: #ffce00 !important;
            border: 3px solid #333 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 28px !important;
            font-weight: bold !important;
            color: #000 !important;
            z-index: 100;
            line-height: 60px;
        }
        
        /* Board Info - Left Side */
        .board-info-left {
            position: absolute;
            left: 8px;
            top: 8px;
            font-size: 15px;
            color: #333;
            line-height: 1.6;
            text-align: left;
        }
        
        .board-info-left .date {
            font-weight: bold;
        }
        
        .board-info-left .dealer {
            background: #ffce00;
            color: black;
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 2px;
            display: block;
        }
        
        .board-info-left .vul {
            background: white;
            color: black;
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 2px;
            display: block;
            margin-top: 2px;
        }
        
        .board-info-left .vul.vul-active {
            background: #cb0000;
            color: white;
        }
        
        /* HCP Display */
        .hcp-display {
            position: absolute;
            left: 335px;
            top: 35px;
            width: 160px;
            font-size: 16px;
            color: #333;
            text-align: center;
        }
        
        .hcp-display .hcp-north {
            text-align: center;
            font-weight: bold;
        }
        
        .hcp-display .hcp-south {
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .hcp-display .hcp-middle {
            display: flex;
            justify-content: space-between;
            padding: 8px 20px;
            margin-top: 5px;
        }
        
        .hcp-display .hcp-value {
            font-weight: bold;
            color: #000;
            font-size: 18px;
        }
        
        /* DD Table - BBO Style */
        .bhDoubleDummy {
            position: absolute;
            padding: 5px 3px;
            border: none;
            background: #c0c1c0;
            font-size: 10px;
            width: auto;
            min-width: 150px;
            left: 1px;
            bottom: 5px;
            color: #000;
            transform: scale(1);
            transform-origin: bottom left;
        }
        
        .bh-dd {
            text-align: center;
            border-collapse: collapse;
            margin-bottom: 5px;
            color: #000;
        }
        
        .bh-dd th, .bh-dd td {
            width: 26px;
            height: 21px;
            text-align: center;
            color: #000;
        }
        
        .bh-dd th {
            font-weight: bold;
            border: none;
            color: #000;
        }
        
        .bh-dd th:first-child {
            width: 20px;
        }
        
        .bh-dd td {
            border: none;
            background: #fff;
            color: #000;
        }
        
        .bh-dd td:first-child {
            border: none;
            font-weight: bold;
            background: transparent;
        }
        
        .bh-dd .suit-symbol {
            font-size: 16px;
        }
        
        .par-display {
            font-size: 12px;
            line-height: 1.4;
            color: #000;
        }
        
        .par-display strong {
            display: block;
        }
        
        /* Suit colors */
        .suit-black { color: #000 !important; }
        .suit-red { color: #cb0000 !important; }
        
        /* LoTT Display */
        .lottDisplay {
            position: absolute;
            padding: 8px;
            border: 1px solid #c0c1c0;
            background: #c0c1c0;
            color: #000;
            font-size: 15px;
            text-align: center;
            min-width: 100px;
            right: 25px;
            bottom: 25px;
            color: black;
        }
        
        .lott-title {
            font-weight: bold;
            color: black;
            margin-bottom: 3px;
            font-size: 1.125em;
        }
        
        .lott-value {
            font-size: 35px;
            font-weight: bold;
            color: black;
        }
        
        .lott-detail {
            font-size: 12.5px;
            color: black;
            margin-top: 3px;
        }
        /* ===== END BBO STYLE ===== */
        
        /* Mobile wrapper for scaling */
        .scale-wrapper {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¥ Ellerin Kƒ±lavuz G√∂r√ºn√ºm√º</h1>
        <div class="tournament-info">
            <span id="tournament-name">Y√ºkleniyor...</span> ‚Ä¢ 
            <span id="board-count">0</span> El
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section" id="filter-section" style="display: none;">
            <div class="filter-group">
                <label for="date-filter">Tarih Filtresi:</label>
                <select id="date-filter" onchange="filterByDate()">
                    <option value="">-- T√ºm Tarihleri G√∂ster --</option>
                </select>
            </div>
            <button class="clear-filter" onclick="clearFilters()">Filtreyi Temizle</button>
        </div>
        
        <div id="loading" class="loading">Elleri y√ºkleniyor...</div>
        <div id="error" class="error" style="display:none;"></div>
        <div class="hands-grid" id="hands-grid"></div>
    </div>

    <script src="card_placement.js"></script>
    <script src="lin_generator.js"></script>
    <script>
        // Main page logic - card placement and diagram rendering functions are in card_placement.js
        // LIN generation functions are in lin_generator.js
        
        // Global variables for filtering
        let allHands = [];
        let allDates = [];

        function formatSuitWithColor(text) {
            if (!text) return '';
            return text
                .replace(/‚ô†/g, '<span class="suit-black">‚ô†</span>')
                .replace(/‚ô£/g, '<span class="suit-black">‚ô£</span>')
                .replace(/‚ô•/g, '<span class="suit-red">‚ô•</span>')
                .replace(/‚ô¶/g, '<span class="suit-red">‚ô¶</span>');
        }

        // DD table rendering is in card_placement.js: renderDDTable()

        // Hand diagram rendering is now in card_placement.js
        // Call: renderHandDiagram(handObj, boardNum, ddResult, optimum, lott)

        // Render hands to grid
        async function renderHands(handsToRender) {
            const grid = document.getElementById('hands-grid');
            grid.innerHTML = '';
            
            console.log(`Rendering ${handsToRender.length} hands`);

            for (const hand of handsToRender) {
                const handObj = {
                    N: hand.N,
                    E: hand.E,
                    S: hand.S,
                    W: hand.W,
                    dealer: hand.dealer || 'N',
                    vulnerability: hand.vulnerability || 'None',
                    date: hand.date || 'Unknown',
                    event_id: hand.event_id || '?'
                };

                // Get DD data from backend API
                let ddResult = null;
                let optimum = null;
                let lott = null;
                
                try {
                    const apiResponse = await fetch(`/api/hand-data?event=${hand.event_id}&board=${hand.board}`);
                    if (apiResponse.ok) {
                        const apiData = await apiResponse.json();
                        ddResult = apiData.dd_result;
                        optimum = apiData.optimum;
                        lott = apiData.lott;
                    }
                } catch (e) {
                    console.warn(`Failed to fetch DD data for board ${hand.board}:`, e);
                }

                // Create custom HTML with event info
                const baseHtml = renderHandDiagram(handObj, hand.board, ddResult, optimum, lott);
                const div = document.createElement('div');
                div.innerHTML = baseHtml;
                
                // Add event label above the hand diagram
                const eventLabel = document.createElement('div');
                eventLabel.style.cssText = 'text-align:center; font-weight:bold; color:#666; margin-bottom:5px; font-size:12px;';
                eventLabel.textContent = `Event ${hand.event_id} | ${hand.date}`;
                
                const container = document.createElement('div');
                container.appendChild(eventLabel);
                container.appendChild(div.firstElementChild);
                grid.appendChild(container);
                
                console.log(`Added hand: Event ${hand.event_id}, Board ${hand.board}`);
            }
            
            console.log(`Total hands added to grid: ${grid.children.length}`);
            const dateCount = new Set(handsToRender.map(h => h.date)).size;
            document.getElementById('tournament-name').textContent = `Events (${handsToRender.length} hands from ${dateCount} date(s))`;
            document.getElementById('board-count').textContent = handsToRender.length;
        }

        // Filter by selected date
        function filterByDate() {
            const selectedDate = document.getElementById('date-filter').value;
            
            if (!selectedDate) {
                console.log(`Showing all ${allHands.length} hands`);
                renderHands(allHands);
                return;
            }
            
            const filtered = allHands.filter(hand => hand.date === selectedDate);
            console.log(`Filtered to ${filtered.length} hands for date ${selectedDate}`);
            renderHands(filtered);
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('date-filter').value = '';
            renderHands(allHands);
        }

        // Load hands from database
        async function loadHands() {
            try {
                const response = await fetch('/hands_database.json');
                if (!response.ok) throw new Error('Failed to load hands database');
                
                const database = await response.json();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('filter-section').style.display = 'flex';

                allHands = database;

                if (allHands.length === 0) throw new Error('No hands found in database');

                // Sort by event_id, then board number
                allHands.sort((a, b) => {
                    if (a.event_id !== b.event_id) return a.event_id - b.event_id;
                    return a.board - b.board;
                });

                // Get unique dates sorted
                allDates = [...new Set(allHands.map(h => h.date))].sort();

                // Populate date filter dropdown
                const dateFilter = document.getElementById('date-filter');
                allDates.forEach(date => {
                    const option = document.createElement('option');
                    option.value = date;
                    option.textContent = date;
                    dateFilter.appendChild(option);
                });

                // Check if URL has a date parameter for auto-filtering
                const params = new URLSearchParams(window.location.search);
                const urlDate = params.get('date');
                console.log(`URL date parameter: ${urlDate}, Available dates: ${allDates.join(', ')}`);
                if (urlDate && allDates.includes(urlDate)) {
                    console.log(`Auto-filtering to date: ${urlDate}`);
                    document.getElementById('date-filter').value = urlDate;
                    filterByDate();
                } else {
                    console.log(`No date filter applied, showing all ${allHands.length} hands`);
                    renderHands(allHands);
                }

            } catch (error) {
                console.error('Error loading hands:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = `Hata: ${error.message}`;
                document.getElementById('error').style.display = 'block';
            }
        }

        // Load on page load
        window.addEventListener('load', loadHands);
    </script>
</body>
</html>
