<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=0">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1e3c72">
    <meta name="description" content="HoÅŸgÃ¶rÃ¼ KulÃ¼bÃ¼ Turnuva Performans Analizi - Turnuva sonuÃ§larÄ±nÄ± analiz edin ve performansÄ±nÄ±zÄ± Ã¶lÃ§Ã¼n!">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Turnuva Analizi">
    <link rel="icon" type="image/png" href="bridge.png?v=2">
    <link rel="shortcut icon" type="image/png" href="bridge.png?v=2">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%231e3c72' width='180' height='180' rx='45'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='70' fill='white' font-weight='bold'>TA</text></svg>">
    <link rel="manifest" href="manifest.json">
    <!-- Cache Kontrol Header'larÄ± -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title data-i18n="title">Turnuva Analiz Paneli</title>
    <link rel="stylesheet" href="style.css?v=145">
    <link rel="stylesheet" href="style_mobile_modal.css?v=2">
    <link rel="stylesheet" href="mobile.css?v=7">
    <script src="script.js?v=377"></script>
</head>
<body>
    <!-- Turnuva SeÃ§imi ModalÄ± -->
    <div id="tournamentSelectModal" style="display:none !important;position:fixed;z-index:99999;top:0;left:0;width:100%;height:100%;background:rgba(30,60,114,0.5);">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:12px;max-width:400px;width:90%;box-shadow:0 4px 20px rgba(0,0,0,0.3);">
            <h2 style="margin:0 0 20px 0;color:#1e3c72;text-align:center;font-size:1.3em;">ğŸ“… Turnuva SeÃ§in</h2>
            <div id="tournamentSelectList" style="margin-bottom:20px;max-height:60vh;overflow-y:auto;"></div>
            <button onclick="closeTournamentSelectModal()" style="display:block;width:100%;padding:12px;background:#ddd;color:#1e3c72;border:none;border-radius:8px;cursor:pointer;font-weight:bold;font-size:1em;">Ä°ptal</button>
        </div>
    </div>
    <div class="container">
        <header>
            <div>
                <h1 id="pageTitle" data-i18n="header.title">Turnuva Analizi - HoÅŸgÃ¶rÃ¼</h1>
                <p id="pageSubtitle" data-i18n="header.subtitle">SonuÃ§larÄ± Analiz Edin ! & PerformansÄ±nÄ±zÄ± Ã–lÃ§Ã¼n !</p>
            </div>
        </header>

        <!-- Bilgi ve Dil SeÃ§imi AlanÄ± -->
        <div style="display: flex; justify-content: flex-start; align-items: center; gap: 12px; margin-bottom: 12px; padding: 8px 10px;">
            <div style="display: flex; gap: 12px; margin-right: auto;">
                <img id="langBtn-tr" src="TR_flag.png" onclick="switchLanguage('tr')" style="width: 36px; height: 36px; cursor: pointer; opacity: 1; transition: opacity 0.2s; border-radius: 3px;" title="TÃ¼rkÃ§e">
                <img id="langBtn-en" src="EN_flag.png" onclick="switchLanguage('en')" style="width: 32px; height: 32px; cursor: pointer; opacity: 0.5; transition: opacity 0.2s; border-radius: 3px;" title="English">
            </div>
            <div id="fileInfo" style="font-size: 13px; color: #00EE00; text-align: center; padding-right: 10px;"><span style="display:inline-block;width:14px;height:14px;border:2px solid rgba(0,238,0,0.3);border-top-color:#00EE00;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:8px;"></span>ğŸ“‚ Veriler gÃ¼ncelleniyor...</div>
        </div>

        <!-- Filtre BÃ¶lÃ¼mÃ¼ -->
        <section class="filters-section">
            
            <!-- Oyuncu Arama (Gizli) -->
            <div class="filter-group" style="margin-bottom:20px;display:none;">
                <h3 style="margin:0 0 12px 0;color:#1e3c72;font-size:0.95em;" data-i18n="filters.playerSearch">ğŸ” Oyuncu Ara</h3>
                <div style="position:relative;">
                    <input type="text" id="playerSearchInput" placeholder="Oyuncu adÄ±nÄ± giriniz..." data-i18n-placeholder="filters.playerSearchPlaceholder" style="width:100%;padding:10px 12px;border:2px solid #ddd;border-radius:6px;font-size:0.95em;box-sizing:border-box;"/>
                    <div id="playerSearchDropdown" style="display:none;position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #ddd;border-top:none;border-radius:0 0 6px 6px;max-height:200px;overflow-y:auto;z-index:100;"></div>
                </div>
            </div>

            <!-- Tarih SeÃ§imi -->
            <div class="filter-group">
                <h2 data-i18n="filters.title">ğŸ“Š Turnuva SonuÃ§larÄ±nÄ± Analiz Et</h2>
                
                <!-- 6-Card Grid: 2 input (date + button) + 4 filter buttons -->
                <div id="dateFilterGrid" class="date-filter-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; align-items: stretch; width: 100%; margin: 0; padding: 0;">
                    <!-- Card 1: Tarih Input -->
                    <input type="date" id="selectedDate" style="height: 48px; padding: 8px 12px; border: 2px solid #ced4da; border-radius: 6px; font-size: 0.9em; box-sizing: border-box; width: 100%; margin: 0; text-align: center; display: flex; align-items: center; justify-content: center;" />
                    
                    <!-- Card 2: Tarih SeÃ§ Button -->
                    <button class="btn btn-info quick-btn" id="filterDateBtn" onclick="filterBySelectedDate()">
                        <span data-i18n="filters.date.select">Tarih SeÃ§</span>
                    </button>
                    
                    <!-- Card 3: Bu Ay -->
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('currentMonth', event); return false;">
                        <span data-i18n="filters.date.currentMonth">ğŸ“… Bu Ay</span>
                    </button>
                    
                    <!-- Card 4: Bu YÄ±l -->
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('currentYear', event); return false;">
                        <span data-i18n="filters.date.currentYear">ğŸ“… Bu YÄ±l</span>
                    </button>
                    
                    <!-- Card 5: Son 3 YÄ±l -->
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('last3Years', event); return false;">
                        <span data-i18n="filters.date.last3Years">ğŸ“… Son 3 YÄ±l</span>
                    </button>
                    
                    <!-- Card 6: 2020'den Beri -->
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('since2020', event); return false;">
                        <span data-i18n="filters.date.since2020">ğŸ“… 2020'den Beri</span>
                    </button>
                </div>
            </div>

            <!-- Oyuncu Arama Filtresi -->
            <div class="filter-group">
                <!-- BaÅŸlÄ±k -->
                <h3 data-i18n="filters.player.title" style="margin: 0 0 15px 0;">ğŸ‘¤ Oyuncu PerformansÄ±nÄ± GÃ¶ster</h3>
                
                <!-- Oyuncu AdÄ± Input'u -->
                <div class="input-group" style="margin-bottom: 15px; position:relative;">
                    <input type="text" id="playerName" data-i18n-placeholder="filters.player.placeholder" style="text-align: center; height: 48px; padding: 8px 12px; border: 2px solid #ced4da; border-radius: 6px; font-size: 0.9em; box-sizing: border-box; width: 100%; margin: 0;" />
                    <!-- Autocomplete Dropdown -->
                    <div id="playerNameSuggestions" style="display:none;position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #ddd;border-radius:0 0 6px 6px;max-height:200px;overflow-y:auto;z-index:100;margin-top:-1px;"></div>
                </div>
                
                <!-- Oyuncu Zaman Filtre ButonlarÄ± -->
                <div id="quickPlayerTimeFilters" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; align-items: stretch; width: 100%;">
                    <button class="btn btn-info quick-btn" onclick="setPlayerTimeFilter('currentMonth', event)">
                        <span data-i18n="filters.date.currentMonth">ğŸ“… Bu Ay</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setPlayerTimeFilter('currentYear', event)">
                        <span data-i18n="filters.date.currentYear">ğŸ“… Bu YÄ±l</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setPlayerTimeFilter('last3Years', event)">
                        <span data-i18n="filters.date.last3Years">ğŸ“… Son 3 YÄ±l</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setPlayerTimeFilter('since2020', event)">
                        <span data-i18n="filters.date.since2020">ğŸ“… 2020'den Beri</span>
                    </button>
                </div>
                </div>
            </div>
        </section>

        <!-- Ä°statistikler -->
        <section class="stats-section" id="statsSection" style="order: 10;">
            <h2 data-i18n="stats.title" id="playerStatsHeader">ğŸ“Š Oyuncu Ä°statistikleri</h2>
            <!-- Sadece filtreler gÃ¶rÃ¼necek, sonuÃ§lar kaldÄ±rÄ±ldÄ± -->
            <script>
            if (window.innerWidth < 700) {
                document.getElementById('statsSection').style.display = 'none';
            }
            </script>
        </section>

        <!-- Desktop versiyonu - YÃ¶n BazÄ±nda SonuÃ§lar (Tek tarih iÃ§in) -->
        <section class="stats-section" id="directionResultsSection" style="order: 5; display: none; width: 100%; padding: 30px; background: white; border-radius: 12px; margin: 20px 0; visibility: visible; opacity: 1; position: relative; z-index: 10;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;" data-i18n="results.tournamentName">Turnuva AdÄ±</h2>
                <button class="btn btn-secondary" id="closeDirectionBtn" onclick="closeDirectionResults()" style="display: none;">
                    â† <span data-i18n="results.back">Geri DÃ¶n</span>
                </button>
            </div>
            <div style="display: flex; justify-content: flex-start; align-items: center; margin-bottom: 20px; gap: 20px; flex-wrap: wrap;">
                <h2 style="margin: 0; display: none;" data-i18n="results.tournamentName">Turnuva AdÄ±</h2>
                <div class="quick-filters-container">
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('currentMonth', event); return false;">
                        <span>ğŸ“… Bu Ay</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('currentYear', event); return false;">
                        <span>ğŸ“… Bu YÄ±l</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('last3Years', event); return false;">
                        <span>ğŸ“… Son 3 YÄ±l</span>
                    </button>
                    <button class="btn btn-info quick-btn" onclick="setDateRangeFilter('since2020', event); return false;">
                        <span>ğŸ“… 2020'den Beri</span>
                    </button>
                </div>
            </div>
            <div class="stats-grid" id="directionResultsGrid" style="display: block; width: 100%; padding: 20px; box-sizing: border-box; min-height: 100px; background: white; border-radius: 12px; margin-top: 20px;">
                <!-- Dinamik olarak doldurulacak -->
            </div>
        </section>

        <!-- Oyuncu Performans Modal (1 Sayfa - Fullscreen) -->
        <div id="playerModal" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);overflow:auto;">
            <div style="width:100%;min-height:100%;background:white;display:flex;flex-direction:column;">
                <!-- Header -->
                <div style="background:#1e3c72;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;flex-shrink:0;">
                    <h2 id="playerModalTitle" style="margin:0;font-size:1.2em;flex:1;text-align:center;">ğŸ‘¤ Oyuncu PerformansÄ±</h2>
                    <button onclick="closePlayerModal()" style="background:none;border:none;color:white;font-size:1.5em;cursor:pointer;flex-shrink:0;">âœ•</button>
                </div>
                <!-- Content -->
                <div id="playerModalContent" style="flex:1;overflow-y:auto;padding:15px;"></div>
                <!-- Navigation Bar -->
                <div style="padding:12px;background:#f5f5f5;border-top:1px solid #ddd;display:flex;gap:10px;justify-content:space-between;align-items:center;flex-shrink:0;">
                    <button id="playerPrevBtn" onclick="showPlayerTab(window.currentPlayerTab - 1)" style="padding:8px 15px;background:#1e3c72;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;"><span data-i18n="pagination.prev">â† Ã–nceki</span></button>
                    <div style="flex:1;"></div>
                    <button id="playerNextBtn" onclick="showPlayerTab(window.currentPlayerTab + 1)" style="padding:8px 15px;background:#1e3c72;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;"><span data-i18n="pagination.next">Sonraki â†’</span></button>
                </div>
                <!-- Sayfa NumarasÄ± -->
                <div style="padding:10px;background:#f5f5f5;border-top:1px solid #ddd;text-align:center;flex-shrink:0;">
                    <span id="playerPageIndicator" style="font-weight:bold;color:#1e3c72;font-size:0.95em;"><span data-i18n="pagination.page">Sayfa</span> 1/<span data-i18n-key="playerPageTotal">2</span></span>
                </div>
            </div>
        </div>

        <!-- MOBÄ°L: 3-SayfalÄ± Modal Sistem (Tarih Filtresi) -->
        <div id="mobileResultsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; flex-direction: column; align-items: stretch;">
            <div style="position: relative; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: stretch;">
                <!-- BaÅŸlÄ±k + Kapat Butonu -->
                <div style="padding: 15px; background: #1e3c72; color: white; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="modalHeaderLabel" style="margin: 0; font-size: 1.2em; flex: 1; text-align: center;" data-i18n="rankings.champsOfDay">GÃ¼nÃ¼n ÅampiyonlarÄ±</h2>
                    <button onclick="closeMobileModal()" style="background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; flex-shrink: 0;">âœ•</button>
                </div>
                
                <!-- Tablar (Navigation) - GÄ°ZLÄ° -->
                <div style="display: none; gap: 5px; padding: 10px; background: #f0f0f0; flex-wrap: wrap;">
                    <button onclick="showDailyResultTab(1)" id="tab1" style="padding: 8px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; flex: 1; min-width: 80px;">ğŸ‘‘ <span data-i18n="rankings.champions">Åampiyonlar</span></button>
                    <button onclick="showDailyResultTab(2)" id="tab2" style="padding: 8px 12px; background: #ddd; color: #333; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; flex: 1; min-width: 80px;">ğŸ—» <span data-i18n="results.northSouth">Kuzey-GÃ¼ney</span></button>
                    <button onclick="showDailyResultTab(3)" id="tab3" style="padding: 8px 12px; background: #ddd; color: #333; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; flex: 1; min-width: 80px;">â†”ï¸ <span data-i18n="results.eastWest">DoÄŸu-BatÄ±</span></button>
                </div>
                
                <!-- Ä°Ã§erik AlanÄ± -->
                <div id="dailyResultsContent" style="flex: 1; overflow-y: auto; padding: 12px; box-sizing: border-box;"></div>
                
                <!-- Navigasyon TuÅŸlarÄ± -->
                <div style="padding: 12px; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-shrink: 0;">
                    <button id="dailyPrevBtn" onclick="handleModalPrevClick()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;"><span data-i18n="pagination.prev">â† Ã–nceki</span></button>
                    <div style="text-align: center; font-weight: bold; font-size: 0.9em;">
                        <span data-i18n="pagination.page">Sayfa</span> <span id="currentPage">1/3</span>
                    </div>
                    <button id="dailyNextBtn" onclick="handleModalNextClick()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;"><span data-i18n="pagination.next">Sonraki â†’</span></button>
                </div>
                
                <!-- Sayfa GÃ¶stergesi (Eski - silinecek) -->
                <div style="display: none; padding: 10px; background: #f8f9fa; text-align: center; font-weight: bold; font-size: 0.9em; flex-shrink: 0;">
                    Sayfa <span id="currentPage">1</span>/3
                </div>
            </div>
        </div>

        <!-- Tarih filtresi genel istatistikleri -->
        <section class="stats-section" id="globalStatsSection">
            <h2 data-i18n="stats.global.title">ğŸ“ˆ Tarih AralÄ±ÄŸÄ± Ã–zet</h2>
            <div class="stats-grid" id="globalStatsGrid">
                <!-- Dinamik olarak doldurulacak -->
            </div>
        </section>

        <!-- SonuÃ§lar BÃ¶lÃ¼mÃ¼ -->
        <section class="results-section" style="display: none;" id="resultsSection2">
            <div class="results-header">
                <h2 data-i18n="results.title">Detay SonuÃ§lar</h2>
                <div class="results-actions">
                    <span id="resultCount" class="result-count"></span>
                    <button class="btn btn-copy" onclick="copyToClipboard()">
                        <span data-i18n="results.copy">ğŸ“‹ SonuÃ§larÄ± Kopyala (Excel'e YapÄ±ÅŸtÄ±r)</span>
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
        <div id="globalStatsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99999; overflow: auto;">
            <div style="width: 100%; min-height: 100%; background: white; display: flex; flex-direction: column;">
                <!-- BaÅŸlÄ±k + Kapat Butonu -->
                <div style="padding: 15px; background: #1e3c72; color: white; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h2 id="globalModalTitle" style="margin: 0; font-size: 1.2em;">Turnuva Ä°statistikleri</h2>
                    <button onclick="closeGlobalStatsModal()" style="background: none; border: none; color: white; font-size: 1.5em; cursor: pointer;">âœ•</button>
                </div>
                
                <!-- Ä°Ã§erik (Dinamik - Sayfa 1 veya 2) -->
                <div id="globalModalContent" style="flex: 1; overflow-y: auto; padding: 20px;">
                </div>
                
                <!-- Modal Footer for Navigation -->
                <div id="globalNavFooter" style="display:none;flex-direction:row;justify-content:space-between;align-items:center;padding:10px 0 0 0;"></div>
            </div>
        </div>

            <!-- Sayfalama -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="btn btn-primary" onclick="previousPage()"><span data-i18n="pagination.prev">â—€ Ã–nceki</span></button>
                <span id="pageInfo"></span>
                <button class="btn btn-primary" onclick="nextPage()"><span data-i18n="pagination.next">Sonraki â–¶</span></button>
            </div>
        </section>

        <!-- Footer -->
        <footer style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.85em;">
            <p style="margin-bottom: 10px;">
                <a href="privacy-policy.html" style="color: #1e3c72; text-decoration: none; margin-right: 20px;">
                    <span id="privacyLink-tr">Gizlilik PolitikasÄ±</span>
                    <span id="privacyLink-en" style="display: none;">Privacy Policy</span>
                </a>
            </p>
            <p>&copy; 2026 HoÅŸgÃ¶rÃ¼ Turnuva Analizi | Tournament Analysis</p>
        </footer>
    </div>

    <!-- XLSX kÃ¼tÃ¼phanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- PWA - Service Worker Registration -->
    <script>
        // Service Worker'Ä± register et (temporarily disabled for debugging)
        if ('serviceWorker' in navigator) {
            // Temporarily disabled - uncomment after database loads properly
            /*
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('âœ“ Service Worker registered:', registration);
                        // PWA kurulumu baÅŸarÄ±lÄ±
                    })
                    .catch(error => {
                        console.warn('Service Worker registration failed:', error);
                    });
            });
            */
        }
        // Unregister any existing Service Workers
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => {
                    registration.unregister();
                    console.log('Service Worker unregistered');
                });
            });
        }
        
        // Install prompt'unu yakala (Add to Home Screen)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA install prompt aktif');
        });
    </script>

</body>
</html>
